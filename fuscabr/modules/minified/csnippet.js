/******************************************
 * FBR - "Funções úteis para o ScadaBR"
 * License: MIT
 ******************************************/
"use strict";fuscabr.csnippet={callbackFunctions:[],runCallbacks:function(){for(var e of fuscabr.csnippet.callbackFunctions)"function"==typeof e&&e()},loadHtmlTemplate:function(){var e=fuscabr.csnippet.conf,t=document.getElementById("fuscabr-csnippet-html-select"),n=t[t.selectedIndex].value;t.disabled=!0;var c=new Event("change"),i=document.getElementById("staticPointContent");ajaxGet(e.htmlTemplatesFolder+n,function(e){i.value=e,i.dispatchEvent(c),t.disabled=!1,fuscabr.csnippet.runCallbacks()},e.templatesLoadTimeout,function(){i.value="<!-- Connection Timeout, please try again -->",i.dispatchEvent(c),t.disabled=!1,fuscabr.csnippet.runCallbacks()},function(){i.value="<!-- Error! Template file not found. -->",i.dispatchEvent(c),t.disabled=!1,fuscabr.csnippet.runCallbacks()})},loadServerScriptTemplate:function(){var e=fuscabr.csnippet.conf,t=document.getElementById("fuscabr-csnippet-script-select"),n=t[t.selectedIndex].value;t.disabled=!0;var c=new Event("change"),i=document.getElementById("graphicRendererScriptScript");ajaxGet(e.serverScriptTemplatesFolder+n,function(e){i.value=e,i.dispatchEvent(c),t.disabled=!1,fuscabr.csnippet.runCallbacks()},e.templatesLoadTimeout,function(){i.value="/* Connection Timeout, please try again */",i.dispatchEvent(c),t.disabled=!1,fuscabr.csnippet.runCallbacks()},function(){i.value="/* Error! Template file not found. */",i.dispatchEvent(c),t.disabled=!1,fuscabr.csnippet.runCallbacks()})},createHtmlInterface:function(){ajaxGet("resources/fuscabr/templates/internal/codeSnippetDiv.html",function(e){var t=e.replace("TEMPLATE","html"),n=document.getElementById("htmlEditor");n.innerHTML=t+n.innerHTML,n.querySelector("img").addEventListener("click",fuscabr.csnippet.loadHtmlTemplate);var c=n.querySelectorAll("*[data-i18n]");for(var i of c){var r=i.getAttribute("data-i18n");fuscabr.common.i18n.csnippet[r]&&localizeElement(i,fuscabr.common.i18n.csnippet[r])}var a=[];for(var i of(a.push(document.createElement("option")),fuscabr.csnippet.conf.htmlTemplates)){var p=document.createElement("option");p.value=i.file,p.innerHTML=fuscabr.common.i18n.csnippet[i.i18n]||i.desc,a.push(p)}a.sort(function(e,t){return e.innerHTML.localeCompare(t.innerHTML)});var l=document.createDocumentFragment();for(var i in a)l.appendChild(a[i]);document.getElementById("fuscabr-csnippet-html-select").appendChild(l),document.querySelector("#staticEditorPopup td[align='right']").addEventListener("click",fuscabr.csnippet.resetSelectedTemplates,!0)})},createServerScriptInterface:function(){ajaxGet("resources/fuscabr/templates/internal/codeSnippetDiv.html",function(e){var t=e.replace("TEMPLATE","script"),n=document.getElementById("graphicRenderer_script");n.innerHTML=n.innerHTML.replace("<br>",t),n.querySelector("img").addEventListener("click",fuscabr.csnippet.loadServerScriptTemplate);var c=n.querySelectorAll("*[data-i18n]");for(var i of c){var r=i.getAttribute("data-i18n");fuscabr.common.i18n.csnippet[r]&&localizeElement(i,fuscabr.common.i18n.csnippet[r])}var a=[];for(var i of(a.push(document.createElement("option")),fuscabr.csnippet.conf.serverScriptTemplates)){var p=document.createElement("option");p.value=i.file,p.innerHTML=fuscabr.common.i18n.csnippet[i.i18n]||i.desc,a.push(p)}a.sort(function(e,t){return e.innerHTML.localeCompare(t.innerHTML)});var l=document.createDocumentFragment();for(var i in a)l.appendChild(a[i]);document.getElementById("fuscabr-csnippet-script-select").appendChild(l),document.querySelector("#graphicRendererEditorPopup td[align='right']").addEventListener("click",fuscabr.csnippet.resetSelectedTemplates,!0)})},resetSelectedTemplates:function(){var e=document.getElementById("fuscabr-csnippet-html-select"),t=document.getElementById("fuscabr-csnippet-script-select");e.selectedIndex=0,t.selectedIndex=0},getSettings:function(){ajaxGetJson("resources/fuscabr/conf/modules/csnippet.json",function(e){fuscabr.csnippet.conf=e,fuscabr.csnippet.init()})},init:function(){fuscabr.csnippet.conf?(fuscabr.csnippet.createHtmlInterface(),fuscabr.csnippet.createServerScriptInterface()):fuscabr.csnippet.getSettings()}},fuscabr.csnippet.init();

/******************************************
 * FBR - "Funções úteis para o ScadaBR"
 * License: MIT
 ******************************************/
"use strict";fuscabr.align={selectedItems:[],lastAnchorPosition:{},currentAnchorPosition:{},elementsFollowAnchor:!1,createInterface:function(){if(!document.getElementById("fuscabr-align")){var e=document.createElement("div");e.id="fuscabr-align",e.className="borderDiv",ajaxGet("resources/fuscabr/templates/internal/alignDiv.html",function(t){e.innerHTML=t,document.getElementById("viewContent").parentElement.parentElement.appendChild(e),fuscabr.align.localizeInterface()})}},showInterface:function(e){e?(document.getElementById("fuscabr-align-start-stop").value=fuscabr.common.i18n.align.stop_alignment,document.getElementById("fuscabr-align-start-stop").setAttribute("onclick","fuscabr.align.stop()"),document.getElementById("fuscabr-align-controls").style.display=""):(document.getElementById("fuscabr-align-start-stop").value=fuscabr.common.i18n.align.start_alignment,document.getElementById("fuscabr-align-start-stop").setAttribute("onclick","fuscabr.align.start()"),document.getElementById("fuscabr-align-controls").style.display="none")},localizeInterface:function(){var e=document.querySelectorAll("#fuscabr-align *[data-i18n]");for(var t of e){var n=t.getAttribute("data-i18n");fuscabr.common.i18n.align[n]&&localizeElement(t,fuscabr.common.i18n.align[n])}},preventDeleteElements:function(e){e?(this.deleteViewComponentBackup=deleteViewComponent,deleteViewComponent=function(){alert(fuscabr.common.i18n.align.cannot_delete_components)}):(deleteViewComponent=this.deleteViewComponentBackup,this.deleteViewComponentBackup=null)},startSelectionMode:function(){if(!document.getElementById("fuscabr-update-trigger")){var e=document.querySelector("img[onclick='addViewComponent()']");e.addEventListener("click",fuscabr.align.updateSelectionMode),e.id="fuscabr-update-trigger"}var t=document.querySelectorAll("#viewContent > div:not(.fuscabr-align):not(.windowDiv)");for(var n of t){this.hoverResponsivity(n,!0),n.classList.add("fuscabr-align");var o=document.createElement("div");o.classList.add("fuscabr-align-preventclick"),o.style="position: absolute; top: 0px; left: 0px; width: 100%; height: 100%;",n.appendChild(o)}},stopSelectionMode:function(){var e=document.getElementById("fuscabr-update-trigger");e.removeEventListener("click",fuscabr.align.updateSelectionMode),e.id="";var t=document.querySelectorAll("#viewContent > div.fuscabr-align");for(var n of t)this.hoverResponsivity(n,!1),n.classList.remove("fuscabr-align"),n.querySelector(".fuscabr-align-preventclick").remove();for(var o=0;o<this.selectedItems.length;o++)0==o?this.unmakeAnchor(this.selectedItems[o]):this.unmakeSelected(this.selectedItems[o]);this.selectedItems=[]},updateSelectionMode:function(){setTimeout(function(){fuscabr.align.startSelectionMode.call(fuscabr.align)},200)},hoverResponsivity:function(e,t){t?(e.addEventListener("mouseover",fuscabr.align.drawHoverBorder),e.addEventListener("mouseout",fuscabr.align.clearHoverBorder),e.addEventListener("click",fuscabr.align.selectItem)):(e.removeEventListener("mouseover",fuscabr.align.drawHoverBorder),e.removeEventListener("mouseout",fuscabr.align.clearHoverBorder),e.removeEventListener("click",fuscabr.align.selectItem),e.style.margin="",e.style.border="")},drawHoverBorder:function(){var e=fuscabr.align.conf;this.style.margin="-2px",this.style.border="2px solid "+e.hoverBorderColor},clearHoverBorder:function(){this.style.margin="",this.style.border=""},selectItem:function(){fuscabr.align.selectedItems.push(this),fuscabr.align.hoverResponsivity(this,!1),1==fuscabr.align.selectedItems.length?fuscabr.align.makeAnchor(this):fuscabr.align.makeSelected(this)},makeSelected:function(e){var t=fuscabr.align.conf;e.style.margin="-2px",e.style.border="2px solid "+t.elementBorderColor},unmakeSelected:function(e){e.style.margin="",e.style.border=""},makeAnchor:function(e){var t=fuscabr.align.conf;e.style.margin="-2px",e.style.border="2px solid "+t.anchorBorderColor;var n=document.createElement("span");n.id="fuscabr-anchor",n.innerHTML=fuscabr.common.i18n.align.anchor||"Anchor",n.style="text-transform: uppercase; font-size: 9px; z-index: 20; 						position: absolute; top: -15px; color: "+t.anchorBorderColor,e.appendChild(n),e.addEventListener("mouseup",fuscabr.align.updateAnchorPosition),fuscabr.align.updateAnchorPosition(!0)},unmakeAnchor:function(e){this.unmakeSelected(e),document.getElementById("fuscabr-anchor").remove(),e.removeEventListener("mouseup",fuscabr.align.updateAnchorPosition),document.getElementById("fuscabr-align-x-anchor").value="",document.getElementById("fuscabr-align-y-anchor").value=""},enableAnchorFollowing:function(e){e?this.elementsFollowAnchor=!0:(this.elementsFollowAnchor=!1,document.getElementById("fuscabr-anchor-following").checked=!1)},getAnchorPosition:function(){var e;return{x:fuscabr.align.selectedItems[0].style.left.replace("px",""),y:fuscabr.align.selectedItems[0].style.top.replace("px","")}},updateAnchorPosition:function(){var e=fuscabr.align.getAnchorPosition();fuscabr.align.currentAnchorPosition!={}&&(fuscabr.align.lastAnchorPosition=fuscabr.align.currentAnchorPosition),fuscabr.align.currentAnchorPosition=e,document.getElementById("fuscabr-align-x-anchor").value=e.x,document.getElementById("fuscabr-align-y-anchor").value=e.y,fuscabr.align.updateComponentPosition(fuscabr.align.selectedItems[0].id),fuscabr.align.elementsFollowAnchor&&fuscabr.align.followAnchor()},enableMovingShortcuts:function(e){e?window.addEventListener("keydown",fuscabr.align.moveKeyboardShortcuts):(window.removeEventListener("keydown",fuscabr.align.moveKeyboardShortcuts),document.getElementById("fuscabr-keyboard-moving").checked=!1)},enableAlignShortcuts:function(e){e?document.body.addEventListener("keyup",fuscabr.align.alignKeyboardShortcuts):document.body.removeEventListener("keyup",fuscabr.align.alignKeyboardShortcuts)},alignKeyboardShortcuts:function(e){"KeyA"==e.code?fuscabr.align.alignLeft():"KeyD"==e.code?fuscabr.align.alignRight():"KeyW"==e.code?fuscabr.align.alignTop():"KeyX"==e.code?fuscabr.align.alignBottom():"KeyF"==e.code?fuscabr.align.centerHorizontal():"KeyG"==e.code?fuscabr.align.centerVertical():"KeyR"==e.code?fuscabr.align.distributeHorizontal():"KeyT"==e.code?fuscabr.align.distributeVertical():"Escape"==e.code?fuscabr.align.stop():"KeyS"==e.code&&fuscabr.align.restart()},moveKeyboardShortcuts:function(e){var t=fuscabr.align.conf.moveAnchorOffset;"ArrowUp"==e.code?(e.preventDefault(),fuscabr.align.relativeMoveAnchor(0,-t)):"ArrowDown"==e.code?(fuscabr.align.relativeMoveAnchor(0,+t),e.preventDefault()):"ArrowLeft"==e.code?(fuscabr.align.relativeMoveAnchor(-t,0),e.preventDefault()):"ArrowRight"==e.code&&(fuscabr.align.relativeMoveAnchor(+t,0),e.preventDefault())},followAnchor:function(){for(var e=this.currentAnchorPosition,t=this.lastAnchorPosition,n=e.x-t.x,o=e.y-t.y,i=fuscabr.align.selectedItems,l=1;l<i.length;l++){var r=parseInt(i[l].style.left.replace("px","")),a=parseInt(i[l].style.top.replace("px",""));i[l].style.left=r+n+"px",i[l].style.top=a+o+"px",fuscabr.align.updateComponentPosition(i[l].id)}},absoluteMoveAnchor:function(){var e=document.getElementById("fuscabr-align-x-anchor").value,t=document.getElementById("fuscabr-align-y-anchor").value;fuscabr.align.selectedItems[0].style.left=Math.round(e)+"px",fuscabr.align.selectedItems[0].style.top=Math.round(t)+"px",fuscabr.align.updateAnchorPosition()},relativeMoveAnchor:function(e,t){var n=fuscabr.align.getAnchorPosition();if(e){var o=n.x-n.x%e+e;fuscabr.align.selectedItems[0].style.left=Math.round(o)+"px"}if(t){var i=n.y-n.y%t+t;fuscabr.align.selectedItems[0].style.top=Math.round(i)+"px"}fuscabr.align.updateAnchorPosition()},alignLeft:function(){var e=this.selectedItems[0].style.left;for(var t of this.selectedItems)t.style.left=e,fuscabr.align.updateComponentPosition(t.id)},alignTop:function(){var e=this.selectedItems[0].style.top;for(var t of this.selectedItems)t.style.top=e,fuscabr.align.updateComponentPosition(t.id)},alignRight:function(){var e,t=Number(this.selectedItems[0].style.left.replace("px",""))+Number(this.selectedItems[0].clientWidth);for(var n of this.selectedItems){var o=Number(n.style.left.replace("px","")),i=o+Number(n.clientWidth),l=o+(t-i);n.style.left=Math.round(l)+"px",fuscabr.align.updateComponentPosition(n.id)}},alignBottom:function(){var e,t=Number(this.selectedItems[0].style.top.replace("px",""))+Number(this.selectedItems[0].clientHeight);for(var n of this.selectedItems){var o=Number(n.style.top.replace("px","")),i=o+Number(n.clientHeight),l=o+(t-i);n.style.top=Math.round(l)+"px",fuscabr.align.updateComponentPosition(n.id)}},centerHorizontal:function(){var e,t=Number(this.selectedItems[0].style.left.replace("px",""))+Number(this.selectedItems[0].clientWidth)/2;for(var n of this.selectedItems){var o=Number(n.style.left.replace("px","")),i=o+Number(n.clientWidth)/2,l=o+(t-i);n.style.left=Math.round(l)+"px",fuscabr.align.updateComponentPosition(n.id)}},centerVertical:function(){var e,t=Number(this.selectedItems[0].style.top.replace("px",""))+Number(this.selectedItems[0].clientHeight)/2;for(var n of this.selectedItems){var o=Number(n.style.top.replace("px","")),i=o+Number(n.clientHeight)/2,l=o+(t-i);n.style.top=Math.round(l)+"px",fuscabr.align.updateComponentPosition(n.id)}},distributeHorizontal:function(){if(!(this.selectedItems.length<3)){var e=this.selectedItems.slice();e.sort(function(e,t){var n;return Number(e.style.left.replace("px",""))>Number(t.style.left.replace("px",""))?1:-1});for(var t=e.length-1,n=Number(e[0].style.left.replace("px","")),o=Number(e[t].style.left.replace("px",""))-n,i=0;i<t;i++)o-=e[i].clientWidth;o/=t;var l=!1;this.elementsFollowAnchor&&(this.elementsFollowAnchor=!1,l=!0);for(var i=1;i<t;i++){var r,a=Number(e[i-1].style.left.replace("px",""))+Number(e[i-1].clientWidth)+o;e[i].style.left=Math.round(a)+"px",fuscabr.align.updateComponentPosition(e[i].id),this.updateAnchorPosition()}l&&(this.elementsFollowAnchor=!0,l=!1)}},distributeVertical:function(){if(!(this.selectedItems.length<3)){var e=this.selectedItems.slice();e.sort(function(e,t){var n;return Number(e.style.top.replace("px",""))>Number(t.style.top.replace("px",""))?1:-1});for(var t=e.length-1,n=Number(e[0].style.top.replace("px","")),o=Number(e[t].style.top.replace("px",""))-n,i=0;i<t;i++)o-=e[i].clientHeight;o/=t;var l=!1;this.elementsFollowAnchor&&(this.elementsFollowAnchor=!1,l=!0);for(var i=1;i<t;i++){var r,a=Number(e[i-1].style.top.replace("px",""))+Number(e[i-1].clientHeight)+o;e[i].style.top=Math.round(a)+"px",fuscabr.align.updateComponentPosition(e[i].id),this.updateAnchorPosition()}l&&(this.elementsFollowAnchor=!0,l=!1)}},updateComponentPosition:function(e){var t=document.getElementById(e),n={top:parseInt(t.style.top.replace("px","")),left:parseInt(t.style.left.replace("px",""))};(isNaN(n.top)||n.top<0)&&(t.style.top="0px"),(isNaN(n.left)||n.left<0)&&(t.style.left="0px"),updateViewComponentLocation(e)},start:function(){this.startSelectionMode(),this.enableAlignShortcuts(!0),this.preventDeleteElements(!0),this.showInterface(!0)},stop:function(){this.stopSelectionMode(),this.enableAlignShortcuts(!1),this.enableMovingShortcuts(!1),this.enableAnchorFollowing(!1),this.preventDeleteElements(!1),this.showInterface(!1)},restart:function(){this.stopSelectionMode(),this.startSelectionMode()},getSettings:function(){ajaxGetJson("resources/fuscabr/conf/modules/align.json",function(e){fuscabr.align.conf=e,fuscabr.align.init()})},init:function(){fuscabr.align.conf?fuscabr.align.createInterface():fuscabr.align.getSettings()}},fuscabr.align.init();